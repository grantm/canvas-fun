<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Fun with HTML Canvas</title>
  <style type="text/css">
    html {
      height: 100%;
    }
    body {
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>

  <canvas id="app-canvas">

  <script type="application/javascript">

    class Point {
        constructor({x, y, xIncrement, yIncrement, maxX, maxY}) {
            this.x = x;
            this.y = y;
            this.xIncrement = xIncrement;
            this.yIncrement = yIncrement;
            this.maxX = maxX;
            this.maxY = maxY;
        }

        nextStep () {
            this.incrementX();
            this.incrementY();
        }

        incrementX () {
            if (this.x + this.xIncrement < 0) {
                this.xIncrement = this.xIncrement * -1;
            }
            if (this.x + this.xIncrement >= this.maxX) {
                this.xIncrement = this.xIncrement * -1;
            }
            this.x = this.x + this.xIncrement;
        }

        incrementY () {
            if (this.y + this.yIncrement < 0) {
                this.yIncrement = this.yIncrement * -1;
            }
            if (this.y + this.yIncrement >= this.maxY) {
                this.yIncrement = this.yIncrement * -1;
            }
            this.y = this.y + this.yIncrement;
        }

    }


    class CanvasManager {
        canvasBackground = "#000000";
        points = [];
        trail = [];
        maxTrailLength = 50;
        hueAngle = 0;
        startX = null;
        startY = null;
        scaleFactor = 7;

        constructor(canvasElement) {
            this.canvasElement = canvasElement;
            this.ctx = canvas.getContext("2d");
            this.setCanvasSize();
            this.setCanvasBackground();
            this.addMouseHandlers();
            this.drawNextLine();
        }

        setCanvasSize() {
            const rect = window.document.documentElement.getBoundingClientRect();
            this.canvasWidth = rect.width;
            this.canvasHeight = rect.height;
            this.canvasElement.width = this.canvasWidth;
            this.canvasElement.height = this.canvasHeight;
        }

        setCanvasBackground() {
            this.ctx.fillStyle = this.canvasBackground;
            this.ctx.fillRect(0, 0, this.canvasWidth, this.canvasHeight);
        }

        addMouseHandlers() {
            canvas.addEventListener("mousedown", e => this.mouseDownHandler(e));
            canvas.addEventListener("mouseup", e => this.mouseUpHandler(e));
        }

        mouseDownHandler(e) {
            this.startX = e.x;
            this.startY = e.y;
        }

        mouseUpHandler(e) {
            this.points.push(
                new Point({
                    x: e.x,
                    y: e.y,
                    xIncrement: (this.startX - e.x) / this.scaleFactor,
                    yIncrement: (this.startY - e.y) / this.scaleFactor,
                    maxX: this.canvasWidth,
                    maxY: this.canvasHeight,
                })
            );
        }

        drawNextLine() {
            if (this.points.length > 0) {
                const path = [];
                this.ctx.lineWidth = 1;
                this.hueAngle = (this.hueAngle + 1) % 360;
                this.ctx.strokeStyle = `hsl(${this.hueAngle}, 100%, 50%)`;
                this.ctx.beginPath();
                this.ctx.moveTo(this.points[0].x, this.points[0].y);
                this.points.forEach(p => {
                    this.ctx.lineTo(p.x, p.y);
                    path.push({x: p.x, y: p.y});
                    p.nextStep();
                });
                this.ctx.stroke();
                this.trail.push(path);
                if (this.trail.length > this.maxTrailLength) {
                    this.eraseLastLine();
                }
            }
        }

        eraseLastLine() {
            const lastPath = this.trail.shift();
            this.ctx.lineWidth = 2;
            this.ctx.strokeStyle = "#000000";
            this.ctx.beginPath();
            this.ctx.moveTo(lastPath[0].x, lastPath[0].y);
            lastPath.forEach(p => {
                this.ctx.lineTo(p.x, p.y);
            });
            this.ctx.stroke();
        }

    }

    const canvas = document.getElementById("app-canvas");
    const manager = new CanvasManager(canvas);

    function drawOneFrame() {
         manager.drawNextLine();
         window.requestAnimationFrame(drawOneFrame);
    }

    drawOneFrame();

  </script>

</body>
</html>
